<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.0-RC3/css/bootstrap-datepicker.min.css"
    />
    <style type="text/css">
      .page-header {
        background-color: #009bdf;
        position: fixed;
        width: 100%;
        top: 0;
        left: 0;
        height: 50px;
      }
      .sidebar {
        background-color: #009bdf;
        position: fixed;
        height: 100%;
        left: 0;
        width: 50px;
        top: 47px;
      }
      .mr-btn-grey {
        padding: 4px 8px;
        background: #c7e1e7;
        border: 1px solid #9dc1cf;
        border-radius: 4px;
      }
      .mr-btn-grey:hover {
        background: #819ca1;
        color: #fff;
        border-color: #6b8a90;
      }
      .mr-header-margin {
        margin-top: 15px !important;
      }
      .mr-panel {
        padding: 15px;
      }
    </style>
  </head>
  <body>
    <div class="page-header">
      <h4 style="padding: 0px; margin-left: 100px; margin-top: 10px;">
        Task Deatails
      </h4>
    </div>
    <div class="sidebar"></div>
    <div class="container">
      <div class="panel panel-default mr-panel">
        <div class="row mr-btn-wrap-top">
          <div class="col-md-12" style="text-align: center;">
            <button
              type="button"
              style="
                background-color: #009bdf;
                margin-top: 50px;
                text-align: right;
              "
              id="btnEditTask"
              class="btn btn-orange btn-sm right mr-btn-margin-5"
            >
              Edit Task
            </button>
          </div>
        </div>
      </div>
      <!-- </div> -->
      <div class="panel panel-default mr-panel" style="padding-bottom: 0cm;">
        <div class="row mr-row">
          <div class="col-md-4">
            <div class="form-group input-group">
              <span class="input-group-addon input-sm">Task Name</span>
              <input
                id="TaskName"
                type="text"
                class="form-control"
                style="width: 200px; margin-left: 10px;"
              />
            </div>
          </div>

          <div class="col-md-4">
            <div class="input-group date" data-provide="datepicker">
              <span class="input-group-addon input-sm">Start Date</span>
              <input
                id="StartDate"
                type="text"
                class="form-control"
                style="width: 200px; margin-left: 10px;"
              />
            </div>
          </div>

          <div class="col-md-4">
            <div class="input-group date" data-provide="datepicker">
              <span class="input-group-addon input-sm">End Date</span>
              <input
                id="EndDate"
                type="text"
                class="form-control"
                style="width: 200px; margin-left: 10px;"
              />
            </div>
          </div>
        </div>
        <div class="row mr-row">
          <div class="col-md-6">
            <div class="form-group input-group">
              <span class="input-group-addon input-sm" style="margin-top: 50px;"
                >Description</span
              >
              <textarea
                class="form-control"
                rows="5"
                id="TaskDescription"
                style="margin-left: 10px;"
              ></textarea>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group input-group" style="margin-top: 50px;">
              <span class="input-group-addon input-sm">Assignee</span>
              <select
                class="form-control input-sm Assignee"
                id="Assignee"
                style="margin-left: 10px;"
              >
                <option value="0"></option>
              </select>
            </div>
          </div>
          <div class="col-md-2">
            <button
              style="background-color: #009bdf; margin-top: 50px;"
              type="button"
              id="saveTask"
              class="btn btn-orange btn-sm right mr-btn-margin-5"
            >
              Save
            </button>
          </div>
        </div>
      </div>

      <!-- </div> -->
    </div>
    <!-- </div> -->
    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/v/dt/dt-1.10.21/datatables.min.css"
    />

    <script
      type="text/javascript"
      src="https://cdn.datatables.net/v/dt/dt-1.10.21/datatables.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.0-RC3/js/bootstrap-datepicker.min.js"
    ></script>
    <script type="text/javascript">
      getAssigneeName();
      EditTask();
      saveTask();
      var TaskID = "{{id}}";
      var TaskName = "{{TaskName}}";
      var ProjectID = "{{ProjectID}}";
      var startDate = "{{startDate}}";
      var EndDate = "{{EndDate}}";
      var Description = "{{Description}}";
      var Assignee = "{{Assignee}}";
      startDate = new Date(startDate);
      var d = startDate.getDay();
      var m = startDate.getMonth() + 1;
      var y = startDate.getFullYear();
      var startDateMain =
        y + "-" + (m <= 9 ? "0" + m : m) + "-" + (d <= 9 ? "0" + d : d);

      EndDate = new Date(EndDate);
      var d1 = EndDate.getDay();
      var m1 = EndDate.getMonth() + 1;
      var y1 = EndDate.getFullYear();
      var EndDateMain =
        y1 + "-" + (m1 <= 9 ? "0" + m1 : m1) + "-" + (d1 <= 9 ? "0" + d1 : d1);

      $.fn.datepicker.defaults.format = "yyyy-mm-dd";
      $(".datepicker").datepicker({
        startDate: "-3d",
      });
      $("#TaskName").val(TaskName);
      $("#StartDate").val(startDateMain);
      $("#EndDate").val(EndDateMain);
      $("#TaskDescription").val(Description);
      //   $("#Assignee option").val(Assignee);

      function getAssigneeName() {
        var request = $.ajax({
          url: "/task_management/getAssigneeName/",
          dataType: "json",
          type: "POST",
          data: {
            csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
          },
        });
        request.done(function (result) {
          if (result != null) {
            var TempId = "";
            var AssigneeName = '<option value="0"></option>';
            for (var i = 0; i < result.length; i++) {
              if (result[i].id != TempId) {
                AssigneeName +=
                  '<option value="' +
                  result[i].id +
                  '">' +
                  result[i].Name +
                  "</option>";
                TempTrip = result[i].id;
              }
            }
            $("#Assignee").html(AssigneeName);
          }
        });
        request.fail(function (jqXHR, textStatus) {
          alert("Error in processing request. Please try again.");
        });
      }
      setAssignee();
      function setAssignee() {
        $("#Assignee option").each(function () {
          if ($(this).html() == Assignee) {
            $(this).attr("selected", "selected");
            return;
          }
        });
      }
      DisableTask();
      function DisableTask() {
        $("#TaskName").prop("disabled", true);
        $("#StartDate").prop("disabled", true);
        $("#EndDate").prop("disabled", true);
        $("#TaskDescription").prop("disabled", true);
      }
      function EditTask() {
        $("#btnEditTask").click(function () {
          $("#TaskName").prop("disabled", false);
          $("#StartDate").prop("disabled", false);
          $("#EndDate").prop("disabled", false);
          $("#TaskDescription").prop("disabled", false);
          setAssignee();
          $("#TaskName").focus();
        });
      }
      function saveTask() {
        $("#saveTask").click(function () {
          var params = getTaskParams();
          if (!validParamsTask(params)) return false;
          var request = $.ajax({
            url: "/task_management/TaskInsertUpdate/",
            dataType: "json",
            type: "POST",
            data: {
              TaskID: params.TaskID,
              ProjectID: params.ProjectID,
              TaskName: params.TaskName,
              StartDate: params.StartDate,
              EndDate: params.EndDate,
              TaskDescription: params.TaskDescription,
              Assignee: params.Assignee,
              csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
            },
          });
          request.done(function (result) {
            var resultdata = JSON.parse(result);
            if (resultdata["Status"] == "Success") {
              alert("Task Updated Successfully");
              getTaskList();
              DisabletaskForm();
            } else {
              alert("Error: " + resultdata["message"]);
            }
          });
          request.fail(function (jqXHR, textStatus) {
            alert("Error in processing request. Please try again.");
          });
        });
      }
      function validParamsTask(params) {
        var errorMsg = "";
        if (params.TaskName == "") {
          errorMsg += "Enter TaskName Name";
        }
        if (params.StartDate == "") {
          errorMsg += "Enter Start Date";
        }
        if (params.EndDate == "") {
          errorMsg += "Enter End Date Name";
        }
        if (params.TaskDescription == "") {
          errorMsg += "Enter Description";
        }
        if (params.Assignee == "") {
          errorMsg += "Enter Assignee Name";
        }
        if (errorMsg == "") {
          return true;
        } else {
          alert("Errors: " + errorMsg);
          return false;
        }
      }
      function getTaskParams() {
        var params = {};
        params.TaskID = TaskID;
        params.ProjectID = ProjectID;
        params.TaskName = $("#TaskName").val().trim();
        params.StartDate = $("#StartDate").val().trim();
        params.EndDate = $("#EndDate").val().trim();
        params.TaskDescription = $("#TaskDescription").val();
        params.Assignee = $("#Assignee option:selected").text().trim();
        return params;
      }
    </script>
  </body>
</html>
